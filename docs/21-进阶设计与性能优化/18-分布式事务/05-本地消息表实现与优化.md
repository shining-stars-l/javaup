---
slug: /architecture/distributed-transaction/local-message-table
sidebar_class_name: has-paid-badge
---

import PaidCTA from '@site/src/components/PaidCTA';

# 本地消息表实现与优化

## 本地消息表方案原理

本地消息表是一种通过在本地数据库创建消息表来保证消息可靠投递的分布式事务解决方案。该方案的核心思想是将分布式事务拆分为本地事务和消息事务两个部分，通过本地事务保证业务数据和消息记录的原子性，再通过定时任务或事件机制保证消息最终能够成功发送并被消费。

### 核心设计思想

本地消息表方案的关键在于：**将业务操作和消息记录放在同一个本地事务中**。这样可以利用数据库的ACID特性，确保只要业务操作成功，本地消息记录就一定能够成功写入。

基本流程如下：

1. 在本地数据库创建消息表，用于记录需要发送的消息
2. 执行业务操作和插入消息记录放在同一个本地事务中
3. 本地事务提交后，异步发送消息到MQ
4. 消费者接收消息后处理业务，处理成功后更新消息表状态
5. 定时任务扫描未成功的消息，进行重新投递

<PaidCTA />