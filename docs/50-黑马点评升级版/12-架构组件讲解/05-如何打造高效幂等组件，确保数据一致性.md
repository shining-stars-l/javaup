---
slug: /hmdp-plus/components/idempotent-component
---

import PaidCTA from '@site/src/components/PaidCTA';

# 如何打造高效幂等组件，确保数据一致性

:::info plus 版本专属
此章节是黑马点评 Plus 版本中专有的内容，而在整套文档中将普通版本和 Plus 版本都融合在了一起，让大家更方便的学习。
:::

首先，我们来介绍什么是幂等，**幂等（Idempotent）** 是一个数学和计算机科学中的概念，主要描述的是一种属性，即一个操作可以被多次应用，但结果仍然保持不变。在数学中，幂等通常用于描述某些运算或函数的特性。例如，对于单目运算，如果一个运算对于在范围内的所有数，多次进行该运算所得的结果和进行一次该运算所得的结果相同，那么该运算就是幂等的。在双目运算中，如果当参与运算的两个值是等值的情况下，运算结果与参与运算的两个值相等，那么该运算也是幂等的



在 Web 项目中，幂等性同样是一个重要的概念。这主要是因为在网络和分布式系统中，由于网络的不稳定性和其他潜在问题，可能会导致请求被重复发送。如果一个操作不是幂等的，那么重复执行该操作可能会产生不一致的结果或副作用。例如，一个非幂等的操作可能会导致数据被重复添加、更新或删除，从而破坏数据的一致性



因此，JavaWeb 项目需要保证幂等性，主要是为了确保无论请求被发送一次还是多次，系统都能产生相同的结果。这有助于避免由于重复请求导致的数据不一致或其他潜在问题。实现幂等性的方法有很多种，包括但不限于使用数据库唯一索引、乐观锁、分布式锁、令牌等技术



总的来说，幂等性是 JavaWeb 项目中一个非常重要的概念，它有助于确保系统的稳定性和数据的一致性。通过实现幂等性，我们可以有效地处理重复请求，并减少由于网络不稳定或其他原因导致的潜在问题



而关于实现幂等的常见方法和技术：

1.  **唯一标识符（Unique Identifiers）**：  
为每个请求生成一个唯一的标识符（如UUID），并将其作为请求的一部分发送。当接收到请求时，服务器可以检查该标识符是否已处理过。如果已处理，则拒绝或忽略该请求；如果未处理，则处理该请求并记录标识符 
2.  **数据库唯一约束**：  
使用数据库的唯一约束（如主键或唯一索引）来确保即使多次尝试插入相同的数据，也只有一条记录会被保存。如果尝试插入重复的数据，数据库会抛出异常，服务器可以捕获这个异常并返回幂等性的响应 
3.  **乐观锁（Optimistic Locking）**：  
使用版本号或时间戳来检查数据是否已被其他操作修改过。在更新数据时，如果版本号或时间戳与预期的不符，则拒绝更新并返回冲突信息。这样，即使多次尝试更新相同的数据，也只有一次会成功 
4.  **分布式锁（Distributed Locking）**：  
在分布式系统中，可以使用分布式锁来确保同一时间只有一个节点能够执行某个操作。这可以防止多个节点同时处理相同的请求，从而实现幂等性 



而今天我们介绍的幂等性组件，不仅仅是单纯实现幂等，而是要在保证实现幂等的前提下，还要考虑高并发下的高效率执行，不能影响程序的性能和吞吐量



基于上述这些要求，最终选择利用 Redis 来实现，而在对使用 Redis 上，Redisson 又是非常优秀的开源中间件，其中的分布式锁是非常的经典，项目中也对分布式锁做了封装，使用起来灵活而方便，而这次幂等组件也是对Redisson 基础上进行封装，保证了性能，支持 MQ 中间件和 用户 API 请求的幂等。

## 为什么不直接使用分布式锁
可能小伙伴会有这样的疑惑，直接使用分布式锁不就行了，为什么还要额外设计出幂等组件？首先直接使用分布式锁是可以实现幂等的，当然业务逻辑验证也要做验证，但其实分布式锁会浪费一些性能

<PaidCTA />