---
slug: /hmdp-plus/sharding/impl1
---
import PaidCTA from '@site/src/components/PaidCTA';

# 分库分表的具体实现-上

:::info plus 版本专属
此章节是黑马点评 Plus 版本中专有的内容，而在整套文档中将普通版本和 Plus 版本都融合在了一起，让大家更方便的学习。
:::

阅读此文前，建议小伙伴先阅读分库分表的前置知识，对分库分表 和 shardingsphere 有了大概的理解后，在继续阅读本文

[全面剖析分库分表](/hmdp-plus/sharding/overview)

## 介绍
在开始介绍前，需要先知道黑马点评 plus 中数据库表的关系是怎么样，关于数据库表设计的详细介绍，小伙伴可跳转到相关文档

[数据库表关系](/hmdp-plus/basics/db-relations)

## 对于分片键的考虑
选择分片键（Sharding Key）是进行数据库分库分表时的关键决策之一，因为它直接影响到数据的分布、查询性能、数据平衡以及系统的可扩展性。选择合适的分片键需要综合考虑以下几个因素：

1. **访问模式和查询性能**：了解应用的数据访问模式是至关重要的。分片键应该选择能够支持高效查询的字段，尽量避免跨分片的查询操作，因为这将大幅度降低查询效率。如果查询经常基于某个字段进行，那么这个字段可能是一个好的分片键候选
2. **数据分布的均匀性**：理想的分片键应该能够使得数据在各个分片之间均匀分布，避免某些分片过热（数据过多导致的负载过高）的情况。均匀的数据分布有助于实现负载均衡，从而提高整体的系统性能和稳定性
3. **数据增长的可预测性**：分片键的选择应考虑到数据增长的模式，以确保系统可以平滑地扩展。选择一个随时间平均增长的分片键可以帮助避免未来的数据迁移和重分片操作
4. **业务逻辑的兼容性**：分片键的选择需要与业务逻辑紧密相连，确保分片操作不会破坏业务逻辑或导致不必要的复杂性。例如，如果业务逻辑需要经常联合多个表查询，那么这些表最好使用相同的分片键

## 配置
### 引入 ShardingSphere 的相关依赖
```xml
<properties>
	<shardingsphere.version>5.3.2</shardingsphere.version>
</properties>
<dependency>
    <groupId>org.apache.shardingsphere</groupId>
    <artifactId>shardingsphere-jdbc-core</artifactId>
    <version>${shardingsphere.version}</version>
    <exclusions>
        <exclusion>
            <artifactId>logback-classic</artifactId>
            <groupId>ch.qos.logback</groupId>
        </exclusion>
    </exclusions>
</dependency>
```

### 根据规则进行分库分表的规则配置
**ShardingSphere 官网的规则配置说明：**

[https://shardingsphere.apache.org/document/5.3.2/cn/user-manual/shardingsphere-jdbc/yaml-config/rules/sharding/](https://shardingsphere.apache.org/document/5.3.2/cn/user-manual/shardingsphere-jdbc/yaml-config/rules/sharding/)


**分库分表指定的位置：**

```yaml
spring:
  datasource:
    driver-class-name: org.apache.shardingsphere.driver.ShardingSphereDriver
    url: jdbc:shardingsphere:classpath:shardingsphere.yaml
```

<PaidCTA />