---
slug: /link-flow/weight-enhancement/version-weighting-design-parse
---

import PaidCTA from '@site/src/components/PaidCTA';

# 版本权重功能的详细设计-上-信息的解析

在 **微服务权重功能的增强-路由隔离后的版本权重功能如何设计** 章节中，详细讲解了如何对原有的负载均衡执行进行替换增加版本权重的功能，此章节将详细讲解此功能的实现

# 版本权重
版本权重的概念是指服务之间调用时，可以指定不同版本的权重调用概率。比如： 有个业务是 user 服务

- user1的服务实例版本为version-1，服务器配置非常的高，那么权重可以设值为90

- user2的服务实例版本为version-2，服务器配置非常的低，那么权重可以设置为10

这样user1的服务实例被调用到的概率是90%，user2的服务实例被调用到的概率是10%

版本权重并没有主动设置开关，只要配置了权重信息就会启动权重策略，没有配置的话就不执行权重策略

## 版本权重配置
版本权重可以在请求头或者配置中心来指定
### 请求头方式
1. 所有服务统一设置为 version-1版本的服务权重为90，version-2版本的服务权重为10
```
link-flow-version-weight={"generalVersionWeightRule":"1=90;2=10"}
```
2. 在a服务中，version-1版本的a服务权重为90，version-2版本的a服务权重为10 <br/>
   在b服务中，version-1版本的b服务权重为70，version-2版本的b服务权重为30
```
link-flow-version-weight={
  "definiteVersionWeightRuleList":[
    {"serverName":"a-service","value":"1=90;2=10"},
    {"serverName":"b-service","value":"1=70;2=30"}
  ]
}
```
### 配置中心方式
1. 所有服务统一设置为 version-1版本的服务权重为90，version-2版本的服务权重为10
```json
{"generalVersionWeightRule":"1=90;2=10"}
```
2. 在a服务中，version-1版本的a服务权重为90，version-2版本的a服务权重为10 <br/>
   在b服务中，version-1版本的b服务权重为70，version-2版本的b服务权重为30
```json
{
  "definiteVersionWeightRuleList":[
      {"serverName":"a-service","value":"1=90;2=10"},
      {"serverName":"b-service","value":"1=70;2=30"}
  ]
}
```
![](/img/link-flow/路由隔离后的版本权重功能如何设计/版本权重.jpg)

<PaidCTA />